<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Portfolio</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>

</head>

<body>

    <section id="hero">
        <canvas id="rain-canvas"></canvas>
        <lottie-player src="./img/ani.json" background="transparent" speed="1" loop autoplay>
        </lottie-player>

        <div class="scroll-down-guide">
            <span>Scroll</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
            </svg>
        </div>
    </section>

    <section id="about">
        <div class="about-strings"></div>
        <div class="about-content">
            <div class="about-photo">
                <img src="./img/about.JPG" onerror="this.src='https://placehold.co/400x600/111/fff?text=Profile+Image'"
                    alt="Profile">
            </div>
            <div class="about-text">
                <h2>About Me </h2>
                <p>
                    안녕하세요.<br>
                    다양한 툴을 조종하고<br>
                    아이디어들을 연결하여<br>
                    창의적인 결과물을 만드는<br>
                    UXUI 디자이너 김미화입니다.
                </p>
                <p>
                    html, css, figma, after effect 등을 다룰 수 있으며<br>
                    7년간의 게임개발통해<br>
                    팀 프로젝트에 강점을 가지고 있습니다.
                </p>
            </div>
        </div>
    </section>

    <section id="stage">

        <div class="marionette-group p1">
            <div class="pendulum">
                <div class="string-rack" data-height="30vh" data-width="500px"></div>
                <div class="mockup-wrapper">
                    <img src="./img/mockup1.png"
                        onerror="this.src='https://placehold.co/500x300/333/fff?text=Project+1+Mockup'"
                        alt="Web Project" class="mockup-img">
                </div>
                <div class="info-bubbles">
                    <div class="bubble b-top-left">
                        <h3>E-Commerce Platform</h3>
                        <p>쇼핑몰 리뉴얼 프로젝트</p>
                    </div>
                    <div class="bubble b-top-right">
                        <p><strong>UIUX Designer</strong> / Figma, Vscode</p>
                    </div>

                    <a href="https://www.figma.com/deck/IKsH8q4N2RwkBbUrrcagfT/%EC%A1%B0%EC%84%A0%EB%AF%B8%EB%85%80-%EA%B8%B0%ED%9A%8D%EC%84%9C?node-id=614-1700&viewport=-148%2C-157%2C0.72&t=8dY42W82rzy5i8kt-1&scaling=min-zoom&content-scaling=fixed&page-id=0%3A1"
                        target="_blank" class="bubble b-bottom-left" style="background: rgba(255,255,255,0.15);">
                        기획서 바로가기
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="inline-block ml-1 mb-0.5">
                            <line x1="7" y1="17" x2="17" y2="7"></line>
                            <polyline points="7 7 17 7 17 17"></polyline>
                        </svg>
                    </a>

                    <a href="https://ddongbae-i.github.io/boj_en/" target="_blank" class="bubble b-bottom-right"
                        style="background: rgba(255,255,255,0.15);">
                        웹 사이트 바로가기
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="inline-block ml-1 mb-0.5">
                            <line x1="7" y1="17" x2="17" y2="7"></line>
                            <polyline points="7 7 17 7 17 17"></polyline>
                        </svg>
                    </a>
                </div>
            </div>
        </div>

        <div class="marionette-group p2">
            <div class="pendulum">
                <div class="string-rack" data-height="15vh" data-width="300px"></div>
                <div class="mockup-wrapper">
                    <img src="./img/mockup2.png"
                        onerror="this.src='https://placehold.co/300x500/555/fff?text=Project+2+Mockup'" alt="Mobile App"
                        class="mockup-img">
                </div>
                <div class="info-bubbles">
                    <div class="bubble b-top-left">
                        <h3>Wellio</h3>
                        <p>가족 건강 커뮤니티 앱</p>
                    </div>
                    <div class="bubble b-top-right">
                        <p><strong>UI/UX Designer</strong> / Figma, Vscode</p>
                    </div>

                    <a href="https://www.figma.com/proto/JPZSjSEHllOM3htmEsBrz4/Untitled?page-id=58%3A2&node-id=58-403&viewport=597%2C232%2C0.09&t=hKRgk9xt5QHwwHds-1&scaling=min-zoom&content-scaling=fixed"
                        target="_blank" class="bubble b-middle-left" style="background: rgba(255,255,255,0.15);">
                        랜딩 페이지 바로가기
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="inline-block ml-1 mb-0.5">
                            <line x1="7" y1="17" x2="17" y2="7"></line>
                            <polyline points="7 7 17 7 17 17"></polyline>
                        </svg>
                    </a>

                    <a href="https://www.figma.com/proto/KNdG0XcTyPQWcolEX3Q7Cy/3%EC%A1%B0-Ai--Wellio--Copy-?page-id=8657%3A13196&node-id=8877-12777&viewport=7539%2C4071%2C0.23&t=TyBjU17Q5fXrzif4-1&scaling=scale-down&content-scaling=fixed&starting-point-node-id=8877%3A13597"
                        target="_blank" class="bubble b-middle-right" style="background: rgba(255,255,255,0.15);">
                        프로토타입 바로가기
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="inline-block ml-1 mb-0.5">
                            <line x1="7" y1="17" x2="17" y2="7"></line>
                            <polyline points="7 7 17 7 17 17"></polyline>
                        </svg>
                    </a>

                    <a href="https://www.figma.com/deck/qOfMjVT2phXFlat17Ra5F3/-AI-%EC%B1%97%EB%B4%87%EC%A7%80%EC%9B%90-%EC%BB%A4%EB%AE%A4%EB%8B%88%ED%8B%B0--%EA%B2%B0%EA%B3%BC%EB%B3%B4%EA%B3%A0%EC%84%9C_%EB%B3%B4%EB%9E%8C3%EC%A1%B0--Wellio---Copy-?node-id=7270-2678&t=yXsOqAnCdIiMy8az-1"
                        target="_blank" class="bubble b-bottom-left">
                        기획서 바로가기
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="inline-block ml-1 mb-0.5">
                            <line x1="7" y1="17" x2="17" y2="7"></line>
                            <polyline points="7 7 17 7 17 17"></polyline>
                        </svg>
                    </a>
                    <a href="https://wellio-iota.vercel.app/" target="_blank" class="bubble b-bottom-right">
                        앱 실행해보기
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"
                            class="inline-block ml-1 mb-0.5">
                            <line x1="7" y1="17" x2="17" y2="7"></line>
                            <polyline points="7 7 17 7 17 17"></polyline>
                        </svg>
                    </a>
                </div>
            </div>
        </div>

    </section>

    <section id="gallery-stage">
        <div class="gallery-bg">
            <img id="bg-img" src="https://placehold.co/1920x1080/111/111?text=%20" alt="Background" style="opacity: 1;">
            <div class="overlay"></div>
        </div>

        <h2 class="gallery-title">Gallery</h2>

        <div class="gallery-content">
            <div class="word-item" data-type="image" data-src="./img/p1.jpg">
                <img src="./img/p1.jpg" onerror="this.src='https://placehold.co/400x250/333/fff?text=Art+P1'"
                    alt="Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">신문 흑백 삽화 1</div>
            </div>
            <div class="word-item" data-type="image" data-src="./img/p2.jpg">
                <img src="./img/p2.jpg" onerror="this.src='https://placehold.co/400x250/333/fff?text=Art+P2'"
                    alt="Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">신문 흑백 삽화 2</div>
            </div>
            <div class="word-item" data-type="image" data-src="./img/p4.png">
                <img src="./img/p4.png" onerror="this.src='https://placehold.co/400x250/333/fff?text=Art+P4+Character'"
                    alt="Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">게임 캐릭터 디자인</div>
            </div>
            <div class="word-item" data-type="image" data-src="./img/p3.jpg">
                <img src="./img/p3.jpg" onerror="this.src='https://placehold.co/400x250/333/fff?text=Art+P3'"
                    alt="Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">신문 흑백 삽화 3</div>
            </div>
            <div class="word-item" data-type="image" data-src="./img/p5.jpg">
                <img src="./img/p5.jpg" onerror="this.src='https://placehold.co/400x250/333/fff?text=Art+P5'"
                    alt="Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">신문 흑백 삽화 4</div>
            </div>
            <div class="word-item" data-type="image" data-src="./img/p6.jpg">
                <img src="./img/p6.jpg" onerror="this.src='https://placehold.co/400x250/333/fff?text=Art+P6'"
                    alt="Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">신문 흑백 삽화 5</div>
            </div>
            <div class="word-item" data-type="image" data-src="./img/p8.png">
                <img src="./img/p8.png" onerror="this.src='https://placehold.co/400x250/333/fff?text=Art+P8+Character'"
                    alt="Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">개인 캐릭터 디자인</div>
            </div>
            <div class="word-item" data-type="image" data-src="./img/p7.jpg">
                <img src="./img/p7.jpg" onerror="this.src='https://placehold.co/400x250/333/fff?text=Art+P7'"
                    alt="Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">신문 흑백 삽화 6</div>
            </div>
            <div class="word-item" data-type="image"
                data-src="https://contents.kyobobook.co.kr/sih/fit-in/458x0/pdt/9788969021915.jpg">
                <img src="https://contents.kyobobook.co.kr/sih/fit-in/458x0/pdt/9788969021915.jpg"
                    onerror="this.src='https://placehold.co/400x250/333/fff?text=Book+Illustration'" alt="Thumbnail"
                    class="thumbnail-img">
                <div class="thumbnail-caption">도서 컬러 삽화</div>
            </div>
            <div class="word-item" data-type="image" data-src="./img/p10.jpg">
                <img src="./img/p10.jpg" onerror="this.src='https://placehold.co/400x250/333/fff?text=Art+P10'"
                    alt="Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">신문 흑백 삽화 7</div>
            </div>
        </div>
    </section>

    <footer>
        <div id="balloon-container"></div> <div class="flex flex-col items-center gap-4 relative z-10">
            <h2 class="text-3xl font-bold text-white tracking-wider mb-2">Thank You</h2>
            <img src="./img/qr.png" onerror="this.src='https://placehold.co/150x150/333/fff?text=QR+Code'"
                alt="Mobile View QR Code" class="w-32 h-32 rounded-lg shadow-lg">
            <p class="text-gray-400 text-sm tracking-widest uppercase">Mobile</p>
        </div>
    </footer>

    <section id="bonus">
        <video autoplay loop muted playsinline class="bonus-bg-video">
            <source src="./img/mov.mp4" type="video/mp4">
        </video>

        <div class="bonus-content">
            <a href="https://testtesttest-sigma.vercel.app/" class="bonus-btn" target="_blank">집사 테스트 시작하기 ▶</a>
        </div>
    </section>

    <div id="image-modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-90 flex items-center justify-center p-4"
        aria-modal="true" role="dialog">
        <div id="loading-spinner" class="text-white flex flex-col items-center">
            <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
            <p class="mt-2 text-sm">콘텐츠 로딩 중...</p>
        </div>
        <div id="modal-content-wrapper"
            class="max-w-full max-h-full overflow-hidden flex justify-center items-center hidden">
            <img id="modal-image" src="" alt="전체 화면 이미지"
                class="w-auto h-[100vh] md:h-[70vh] object-contain rounded-lg shadow-2xl transition-all duration-300 cursor-pointer">
        </div>
    </div>

    <script>
        gsap.registerPlugin(ScrollTrigger);

        ScrollTrigger.normalizeScroll(true);
        ScrollTrigger.config({ ignoreMobileResize: true });

        // --- 0. Hero 색상 전환 및 Pin ---
        let rainMode = 0;
        let rainControl = { ratio: 1 };

        const heroTl = gsap.timeline({
            scrollTrigger: {
                trigger: "#hero",
                start: "top top",
                end: "+=4000",
                scrub: 0.5,
                pin: true,
                onUpdate: (self) => {
                    rainMode = self.progress;
                }
            }
        });

        // [수정됨] 스크롤 시작 시 로티와 함께 화살표(.scroll-down-guide)도 사라지게 설정
        heroTl.to("#hero", { backgroundColor: "#000000", duration: 1 })
            .to(["lottie-player", ".scroll-down-guide"], { opacity: 0, autoAlpha: 0, duration: 0.4 }, 0.1)
            .to(rainControl, { ratio: 0, duration: 0.5 }, 0.5);

        // --- 마리오네트 실(비) 효과 ---
        const canvas = document.getElementById('rain-canvas');
        const ctx = canvas.getContext('2d');
        const portfolioChars = "PORTFOLIO".split("");

        let canvasWidth, canvasHeight;
        let rains = [];
        let texts = [];

        function initRain() {
            canvasWidth = window.innerWidth;
            canvasHeight = window.innerHeight;
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;

            rains = [];
            texts = [];
            const rainCount = Math.floor(canvasWidth * 0.1);
            const textCount = 15;

            for (let i = 0; i < rainCount; i++) {
                rains.push(new RainDrop());
            }

            for (let i = 0; i < textCount; i++) {
                texts.push(new TextDrop());
            }
        }

        class RainDrop {
            constructor() {
                this.reset();
                this.y = Math.random() * canvasHeight;
            }

            reset() {
                this.x = Math.random() * canvasWidth;
                this.y = -Math.random() * 200;
                this.baseLength = Math.random() * 200 + 100;
                this.slowSpeed = Math.random() * 0.5 + 0.2;
                this.fastSpeed = Math.random() * 2 + 1;
                this.opacity = Math.random() * 0.2 + 0.05;
                this.r = Math.floor(Math.random() * 100) + 155;
                this.g = Math.floor(Math.random() * 100) + 155;
                this.b = Math.floor(Math.random() * 100) + 155;
            }

            update() {
                const currentSpeed = this.slowSpeed + (this.fastSpeed - this.slowSpeed) * rainMode;
                this.y += currentSpeed;
                if (this.y > canvasHeight) {
                    this.reset();
                }
            }

            draw(index, total) {
                ctx.beginPath();
                const minRain = 30;
                let fadeFactor = 1;

                if (index >= minRain) {
                    const countToFade = total - minRain;
                    const normalizedIndex = (index - minRain) / countToFade;
                    const distance = rainControl.ratio - normalizedIndex;
                    fadeFactor = Math.max(0, Math.min(1, distance * 5));
                }

                const currentOpacity = this.opacity * fadeFactor;
                if (currentOpacity <= 0.01) return;

                const currentLength = this.baseLength * rainMode;
                const startWidth = 15;
                const endWidth = 1;
                const currentWidth = startWidth - (startWidth - endWidth) * rainMode;

                ctx.lineCap = 'round';
                ctx.moveTo(this.x, this.y);
                ctx.lineTo(this.x, this.y + currentLength);
                ctx.strokeStyle = `rgba(${this.r}, ${this.g}, ${this.b}, ${currentOpacity})`;
                ctx.lineWidth = currentWidth;
                ctx.stroke();
            }
        }

        class TextDrop {
            constructor() {
                this.reset();
                this.y = Math.random() * canvasHeight;
            }

            reset() {
                this.x = Math.random() * canvasWidth;
                this.y = -Math.random() * 500;
                this.text = portfolioChars[Math.floor(Math.random() * portfolioChars.length)];
                this.fontSize = Math.floor(Math.random() * 50) + 50;
                this.slowSpeed = Math.random() * 0.5 + 0.2;
                this.fastSpeed = Math.random() * 2 + 1;
                this.opacity = Math.random() * 0.2 + 0.1;
                this.r = Math.floor(Math.random() * 100) + 155;
                this.g = Math.floor(Math.random() * 100) + 155;
                this.b = Math.floor(Math.random() * 100) + 155;
            }

            update() {
                const currentSpeed = this.slowSpeed + (this.fastSpeed - this.slowSpeed) * rainMode;
                this.y += currentSpeed;
                if (this.y > canvasHeight + 150) {
                    this.reset();
                }
            }

            draw(index, total) {
                const minText = 3;
                let fadeFactor = 1;

                if (index >= minText) {
                    const countToFade = total - minText;
                    const normalizedIndex = (index - minText) / countToFade;
                    const distance = rainControl.ratio - normalizedIndex;
                    fadeFactor = Math.max(0, Math.min(1, distance * 5));
                }

                let activeOpacity = this.opacity * (1 - rainMode * 10);
                if (activeOpacity < 0) activeOpacity = 0;
                activeOpacity *= fadeFactor;

                if (activeOpacity <= 0.01) return;

                ctx.fillStyle = `rgba(${this.r}, ${this.g}, ${this.b}, ${activeOpacity})`;
                ctx.font = `bold ${this.fontSize}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.fillText(this.text, this.x, this.y);
            }
        }

        function animateRain() {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            rains.forEach((rain, i) => {
                rain.update();
                rain.draw(i, rains.length);
            });
            texts.forEach((text, i) => {
                text.update();
                text.draw(i, texts.length);
            });
            requestAnimationFrame(animateRain);
        }

        window.addEventListener('resize', initRain);
        initRain();
        animateRain();

        // --- Bubble Colors ---
        function colorizeBubbles() {
            const bubbles = document.querySelectorAll('.info-bubbles .bubble');
            bubbles.forEach(bubble => {
                const r = Math.floor(Math.random() * 100) + 100;
                const g = Math.floor(Math.random() * 100) + 100;
                const b = Math.floor(Math.random() * 100) + 100;
                bubble.style.background = `rgba(${r}, ${g}, ${b}, 0.5)`;
                bubble.style.border = `1px solid rgba(${r}, ${g}, ${b}, 0.8)`;
            });
        }
        colorizeBubbles();

        // --- Gallery Hover Colors ---
        function setupGalleryItems() {
            const items = document.querySelectorAll('.word-item');
            items.forEach(item => {
                const r = Math.floor(Math.random() * 100) + 155;
                const g = Math.floor(Math.random() * 100) + 155;
                const b = Math.floor(Math.random() * 100) + 155;
                item.style.setProperty('--hover-border-color', `rgba(${r}, ${g}, ${b}, 0.8)`);
                item.style.setProperty('--hover-color', `rgba(${r}, ${g}, ${b}, 0.8)`);
            });
        }
        setupGalleryItems();

        // --- About Section Triggers ---
        ScrollTrigger.create({
            trigger: "#about",
            start: "top 60%",
            onEnter: () => document.getElementById('about').classList.add('strings-active'),
            onLeaveBack: () => document.getElementById('about').classList.remove('strings-active')
        });

        ScrollTrigger.create({
            trigger: "#about",
            start: "top top",
            end: "+=3000",
            pin: true,
            scrub: true,
            onEnter: () => {
                document.querySelector('.about-content').classList.add('content-active');
            },
            onLeaveBack: () => {
                document.querySelector('.about-content').classList.remove('content-active');
            },
            onLeave: () => {
                gsap.to(".about-strings", { opacity: 0, duration: 1 });
            },
            onEnterBack: () => {
                gsap.to(".about-strings", { opacity: 1, duration: 0.5 });
            }
        });

        // --- Marionette Logic ---
        function createBalancedStrings() {
            const racks = document.querySelectorAll('.string-rack');
            const zones = [{ min: 5, max: 20 }, { min: 30, max: 45 }, { min: 55, max: 70 }, { min: 80, max: 95 }];

            racks.forEach(rack => {
                rack.innerHTML = '';
                const isMobile = window.innerWidth <= 768;

                if (isMobile) {
                    rack.style.width = '30vw';
                    rack.style.maxWidth = 'none';
                } else {
                    rack.style.width = rack.dataset.width;
                    rack.style.maxWidth = 'none';
                    rack.style.height = rack.dataset.height;
                }

                zones.forEach(zone => {
                    const string = document.createElement('div');
                    string.classList.add('string');
                    const randomLeft = Math.floor(Math.random() * (zone.max - zone.min + 1)) + zone.min;
                    string.style.left = `${randomLeft}%`;
                    const minOp = 0.10; const maxOp = 0.40;
                    const op = (Math.random() * (maxOp - minOp) + minOp).toFixed(2);
                    string.style.background = `rgba(255, 255, 255, ${op})`;
                    string.style.boxShadow = `0 0 ${op * 2}px rgba(255, 255, 255, ${op * 0.3})`;
                    rack.appendChild(string);
                });
            });
        }

        createBalancedStrings();
        window.addEventListener('resize', () => { createBalancedStrings(); });


        // --- Marionette Timeline ---
        const tl = gsap.timeline({
            scrollTrigger: { trigger: "#stage", start: "top top", end: "+=5500", pin: true, scrub: 1 }
        });

        gsap.set(".marionette-group", { autoAlpha: 0 });
        gsap.set(".bubble", { y: 30, autoAlpha: 0 });

        const isMobile = window.innerWidth <= 768;
        const startX_Right = isMobile ? 0 : "35vw";
        const startX_Left = isMobile ? 0 : "-35vw";

        tl.fromTo(".p1", { x: startX_Right, scale: 0.5, filter: "blur(10px)", autoAlpha: 0 }, { x: "0%", scale: 1, filter: "blur(0px)", autoAlpha: 1, duration: 5, ease: "power1.out" })
            .to(".p1 .bubble", { autoAlpha: 1, y: 0, duration: 1, stagger: 0.15, ease: "back.out(1.7)" })
            .to({}, { duration: 3 })
            .to(".p1 .bubble", { autoAlpha: 0, y: -30, duration: 0.5, stagger: 0.05 })
            .to(".p1", { scale: 5, autoAlpha: 0, filter: "blur(20px)", duration: 3 })

            .fromTo(".p2", { x: startX_Left, scale: 0.5, filter: "blur(10px)", autoAlpha: 0 }, { x: "0%", scale: 1, filter: "blur(0px)", autoAlpha: 1, duration: 5, ease: "power1.out" })
            .to(".p2 .bubble", { autoAlpha: 1, y: 0, duration: 1, stagger: 0.15, ease: "back.out(1.7)" })
            .to({}, { duration: 3 })
            .to(".p2 .bubble", { autoAlpha: 0, y: -30, duration: 0.5, stagger: 0.05 })
            .to(".p2", { scale: 5, autoAlpha: 0, filter: "blur(20px)", duration: 3 });


        // --- Physics Engine ---
        const groups = document.querySelectorAll(".marionette-group");
        const CONFIG = { TENSION: 0.04, FRICTION: 0.85, FORCE: 0.015, MAX_ANGLE: 3 };

        groups.forEach(group => {
            const pendulum = group.querySelector(".pendulum");
            let rotation = 0; let velocity = 0; let prevX = null;

            gsap.ticker.add(() => {
                const currentX = group.getBoundingClientRect().left;
                if (prevX === null || Math.abs(currentX) > 10000) { prevX = currentX; return; }
                const dx = currentX - prevX;
                const opacity = window.getComputedStyle(group).opacity;

                if (Math.abs(dx) < 50 && opacity > 0.1) {
                    velocity += dx * CONFIG.FORCE; velocity += -rotation * CONFIG.TENSION; velocity *= CONFIG.FRICTION; rotation += velocity;
                    if (rotation > CONFIG.MAX_ANGLE) rotation = CONFIG.MAX_ANGLE;
                    if (rotation < -CONFIG.MAX_ANGLE) rotation = -CONFIG.MAX_ANGLE;
                    if (Math.abs(rotation) < 0.01 && Math.abs(velocity) < 0.01) { rotation = 0; velocity = 0; }
                } else { velocity = 0; }

                const xPercent = window.innerWidth <= 768 ? 0 : -50;
                gsap.set(pendulum, { xPercent: xPercent, rotation: rotation });
                prevX = currentX;
            });
        });


        // --- Gallery Logic ---
        const items = document.querySelectorAll(".word-item");
        const STAGGER_AMOUNT = 0.08;
        let interactionTimer;

        items.forEach((item, index) => {
            const src = item.dataset.src;

            item.addEventListener("mouseenter", () => {
                updateGalleryBackground(src);
                gsap.to(".gallery-title", { autoAlpha: 0, duration: 0.3, overwrite: true });
            });

            item.addEventListener("click", () => { openModal(src); });
        });

        items.forEach((item, index) => {
            item.style.setProperty('--item-delay', `${index * STAGGER_AMOUNT}s`);
        });

        ScrollTrigger.create({
            trigger: "#gallery-stage",
            start: "top top",
            end: "+=1500",
            pin: true,
            scrub: true
        });

        ScrollTrigger.create({
            trigger: "#gallery-stage",
            start: "top 60%",
            onEnter: () => {
                items.forEach(item => item.classList.add('is-active'));

                clearTimeout(interactionTimer);
                interactionTimer = setTimeout(() => {
                    items.forEach(item => item.classList.add('interaction-ready'));
                }, 500);
            },
            onLeaveBack: () => {
                items.forEach(item => {
                    item.classList.remove('is-active');
                    item.classList.remove('interaction-ready');
                });
                clearTimeout(interactionTimer);
            },
            toggleActions: "play none none reverse"
        });

        // --- Modal & Background Logic ---
        const galleryBgImg = document.getElementById("bg-img");
        const modal = document.getElementById('image-modal');
        const modalContentWrapper = document.getElementById('modal-content-wrapper');
        const loadingSpinner = document.getElementById('loading-spinner');
        const modalImage = document.getElementById('modal-image');

        const updateGalleryBackground = (src) => {
            if (galleryBgImg.src.includes(src)) { return; }
            gsap.killTweensOf(galleryBgImg);
            gsap.to(galleryBgImg, {
                opacity: 0, duration: 0.2, filter: 'blur(5px)',
                onComplete: () => {
                    galleryBgImg.src = src;
                    gsap.to(galleryBgImg, { opacity: 1, duration: 0.4, filter: 'blur(0px)' });
                }
            });
        };

        const closeModal = () => {
            modalContentWrapper.classList.remove('modal-enter-active');
            modal.classList.add('hidden');
            modalImage.src = '';
        };

        const openModal = (src) => {
            modal.classList.remove('hidden');
            loadingSpinner.classList.remove('hidden');
            modalContentWrapper.classList.add('hidden');
            modalImage.style.display = 'none';

            const tempImg = new Image();
            tempImg.onload = () => {
                modalImage.src = src;
                modalImage.style.display = 'block';
                loadingSpinner.classList.add('hidden');
                modalContentWrapper.classList.remove('hidden');
                modalContentWrapper.classList.add('modal-enter-active');
            };
            tempImg.onerror = () => {
                loadingSpinner.classList.add('hidden');
                closeModal();
            };
            tempImg.src = src;
        };

        modalImage.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && !modal.classList.contains('hidden')) closeModal(); });

        // --- About Section Strings ---
        function createAboutStrings() {
            const container = document.querySelector('.about-strings');
            container.innerHTML = '';

            const stringCount = 10;

            for (let i = 0; i < stringCount; i++) {
                const str = document.createElement('div');
                str.classList.add('about-string');
                str.style.left = Math.random() * 100 + '%';
                const r = Math.floor(Math.random() * 155) + 100;
                const g = Math.floor(Math.random() * 155) + 100;
                const b = Math.floor(Math.random() * 155) + 100;
                const opacity = (Math.random() * 0.4 + 0.1).toFixed(2);
                str.style.background = `rgba(${r}, ${g}, ${b}, ${opacity})`;
                str.style.transitionDelay = Math.random() * 1 + 's';
                container.appendChild(str);
            }
        }
        createAboutStrings();

        // --- [NEW] Balloon Animation Logic (Snow-like Update) ---
        function createBalloons() {
            const container = document.getElementById('balloon-container');
            const balloonCount = 50; // 눈송이 느낌을 위해 개수 유지 또는 약간 증가

            for (let i = 0; i < balloonCount; i++) {
                const balloon = document.createElement('div');
                balloon.classList.add('balloon');

                // 랜덤 속성 부여: 크기를 작게 조절 (5px ~ 20px)
                const size = Math.random() * 15 + 5;
                const left = Math.random() * 100; // 0% ~ 100%

                balloon.style.width = `${size}px`;
                balloon.style.height = `${size}px`;
                balloon.style.left = `${left}%`;

                // 투명도 조절로 '연한' 느낌 (0.2 ~ 0.7)
                const opacity = Math.random() * 0.5 + 0.2;
                balloon.style.backgroundColor = `rgba(255, 255, 255, ${opacity})`;

                container.appendChild(balloon);
            }

            // GSAP 애니메이션 (ScrollTrigger 연동)
            const tl = gsap.timeline({
                scrollTrigger: {
                    trigger: "footer",
                    start: "top 90%", // 푸터가 보이기 시작할 때
                    toggleActions: "restart none none reset"
                }
            });

            // 1. 배경색 전환: 회색(#505050) -> 검정(#000000)
            tl.fromTo("footer",
                { backgroundColor: "#505050" },
                { backgroundColor: "#000000", duration: 3, ease: "power1.inOut" },
                0 // 시작 시간 0초 (동시 실행)
            );

            // 2. 풍선(눈송이) 올라가는 애니메이션
            tl.to(".balloon", {
                y: -window.innerHeight * 1.2, // 화면 위로 올라감
                opacity: 0,
                duration: "random(3, 6)", // 천천히 부드럽게
                ease: "power1.out",
                stagger: {
                    amount: 2, // 순차적으로
                    from: "random"
                }
            }, 0); // 배경색 전환과 동시에 시작
        }

        // 실행
        createBalloons();

    </script>
</body>

</html>