<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Marionette Final + Gallery</title>
    <!-- Tailwind CSS (ëª¨ë‹¬ ìŠ¤íƒ€ì¼ë§ì— ì‚¬ìš©) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- GSAP ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <style>
        /* --- ê¸°ë³¸ ì„¤ì • --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: #0a0a0a; color: #fff; font-family: sans-serif; overflow-x: hidden; }
        a { color: inherit; text-decoration: none; }

        section { width: 100%; display: flex; flex-direction: column; align-items: center; position: relative; }
        #hero { height: 100vh; background: radial-gradient(#333, #000); justify-content: center; z-index: 10; }
        #about { min-height: 50vh; background: #111; padding: 50px; text-align: center; z-index: 10; }

        /* í”„ë¡œì íŠ¸ ìŠ¤í…Œì´ì§€ (Pinned) */
        #stage {
            height: 100vh; width: 100%;
            background-color: #000;
            overflow: hidden; 
            position: relative;
            perspective: 1000px;
        }

        /* -------------------------------------------
            ìƒˆë¡œ ì¶”ê°€ëœ ê°¤ëŸ¬ë¦¬ ì„¹ì…˜ ìŠ¤íƒ€ì¼
            ------------------------------------------- */
        #gallery-stage {
            height: 100vh;
            width: 100%;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
            z-index: 20;
            /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë³€ê²½í•˜ì—¬ 10ê°œ ì•„ì´í…œì„ ë„ì›€ */
            padding: 50px 20px; 
        }

        /* ë°°ê²½ (ì´ë¯¸ì§€) */
        .gallery-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
        }
        .gallery-bg img {
            width: 100%; height: 100%; object-fit: cover; 
            /* GSAPìœ¼ë¡œ ì œì–´ë˜ë¯€ë¡œ CSS transitionì€ ìµœì†Œí™” */
        }
        .gallery-bg .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
        }

        /* í…ìŠ¤íŠ¸ ë¦¬ìŠ¤íŠ¸ (ë°ìŠ¤í¬í†± ê¸°ë³¸: 5ì—´) */
        .gallery-content {
            position: relative; z-index: 2; display: grid; /* Flex ëŒ€ì‹  Grid ì‚¬ìš© */
            grid-template-columns: repeat(5, 1fr); 
            gap: 1.5rem;
            max-width: 1200px;
            width: 100%;
        }

        /* -------------------------------------------
            [ì¸ë„¤ì¼/í”¼ë“œ ìŠ¤íƒ€ì¼ ì ìš©]
            ------------------------------------------- */
        .word-item {
            cursor: pointer;
            background-color: #1a1a1a; /* ì–´ë‘ìš´ ë°°ê²½ */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); /* Subtle shadow */
            position: relative;
            opacity: 0; /* GSAP ì´ˆê¸° ìˆ¨ê¹€ ìœ ì§€ */
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
            text-align: center;
        }
        .word-item:hover { 
            transform: scale(1.02); 
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
            border-color: rgba(255, 255, 255, 0.5); /* í˜¸ë²„ ì‹œ í…Œë‘ë¦¬ ê°•ì¡° */
        }

        .thumbnail-img {
            width: 100%;
            height: auto;
            object-fit: cover;
            aspect-ratio: 16/10; /* ì¸ë„¤ì¼ ë¹„ìœ¨ (ê°€ë¡œê°€ ê¸´ ì§ì‚¬ê°í˜•) */
            display: block;
            transition: opacity 0.3s ease;
        }
        .word-item:hover .thumbnail-img {
            opacity: 0.7;
        }

        .thumbnail-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            /* í…ìŠ¤íŠ¸ ë²„íŠ¼ì˜ ê·¸ë¼ë°ì´ì…˜ ìŠ¤íƒ€ì¼ ëŒ€ì‹  ê¹”ë”í•œ ìº¡ì…˜ ìŠ¤íƒ€ì¼ ì ìš© */
            background: rgba(0, 0, 0, 0.6);
            padding: 0.5rem 0.5rem;
            font-size: 1rem;
            font-weight: bold;
            color: #fff;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* -------------------------------------------
            [ì¸ë„¤ì¼/í”¼ë“œ ìŠ¤íƒ€ì¼ ì ìš© ë]
            ------------------------------------------- */
        
        /* ëª¨ë‹¬ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
        }

        /* -------------------------------------------
            [ë°˜ì‘í˜• ê°¤ëŸ¬ë¦¬ ì¡°ì •] - ì¸ë„¤ì¼ í¬ê¸°ì— ë§ì¶° ì¡°ì •
            ------------------------------------------- */

        /* íƒœë¸”ë¦¿ ê°€ë¡œ / ì†Œí˜• ë°ìŠ¤í¬í†± (ìµœëŒ€ 1024px) */
        @media (max-width: 1024px) {
            .gallery-content {
                grid-template-columns: repeat(4, 1fr); /* 4ì—´ */
            }
            .thumbnail-caption { font-size: 0.9rem; }
        }

        /* íƒœë¸”ë¦¿ ì„¸ë¡œ (ìµœëŒ€ 768px) */
        @media (max-width: 768px) {
            .gallery-content {
                grid-template-columns: repeat(3, 1fr); /* 3ì—´ */
                gap: 1rem;
            }
            .thumbnail-caption { font-size: 0.8rem; padding: 0.4rem; }
        }
        
        /* ìˆœìˆ˜ ëª¨ë°”ì¼ (ìµœëŒ€ 480px) */
        @media (max-width: 480px) {
            .gallery-content {
                grid-template-columns: repeat(2, 1fr); /* 2ì—´ */
                gap: 0.75rem;
            }
            .thumbnail-caption { 
                font-size: 0.7rem; 
                padding: 0.3rem;
            }
        }
        /* -------------------------------------------
            [ë°˜ì‘í˜• ê°¤ëŸ¬ë¦¬ ì¡°ì • ë]
            ------------------------------------------- */


        footer { height: 50vh; background: #050505; justify-content: center; display: flex; align-items: center; z-index: 10; }

        /* -------------------------------------------
            Marionette & Bubble Styles (ê¸°ì¡´ ì½”ë“œ)
            ------------------------------------------- */
        .marionette-group {
            position: absolute; top: 0; left: 50%; width: 2px; height: 100vh; pointer-events: none; will-change: transform, opacity, filter; z-index: 5; opacity: 0; visibility: hidden; 
        }

        .pendulum { position: absolute; top: 0; left: 0; width: auto; display: flex; flex-direction: column; align-items: center; transform-origin: center top; }
        .string-rack { position: relative; width: 100%; }
        .string { position: absolute; top: 0; height: 100%; width: 1px; background: rgba(255, 255, 255, 0.3); }

        .mockup-wrapper { position: relative; z-index: 2; margin-top: 0; }
        .mockup-img { display: block; border-radius: 12px; box-shadow: 0 20px 50px rgba(0,0,0,0.7); object-fit: contain; }
        
        .p1 .mockup-img { width: 500px; height: auto; }
        .p2 .mockup-img { width: 300px; height: auto; }
        .p3 .mockup-img { width: 500px; height: auto; }

        .info-bubbles { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90vw; max-width: 1000px; height: 600px; pointer-events: none; z-index: 10; }
        .bubble { position: absolute; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 16px; padding: 15px 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 250px; opacity: 0; visibility: hidden; transition: transform 0.3s ease, background 0.3s ease; }
        a.bubble { pointer-events: auto; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; }
        a.bubble:hover { background: rgba(255, 255, 255, 0.2); transform: translateY(-3px); }
        .bubble h3 { font-size: 1.1rem; margin-bottom: 8px; color: #fff; }
        .bubble p { font-size: 0.9rem; line-height: 1.5; color: #ddd; margin: 0; }
        
        .b-top-left { top: 10%; left: 0; }
        .b-top-right { top: 10%; right: 0; text-align: right; }
        .b-bottom-left { bottom: 15%; left: 20px; }
        .b-bottom-right { bottom: 15%; right: 20px; }


        /* -------------------------------------------
            ğŸ“± ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ ì˜¤ë²„ë¼ì´ë“œ
            ------------------------------------------- */
        @media (max-width: 768px) {
            
            .marionette-group {
                position: absolute; left: 0; top: 0; width: 100%; height: 100vh;
                display: flex; flex-direction: column; justify-content: flex-start; align-items: center;
                padding-bottom: 50px;
            }

            .pendulum { position: relative; top: auto; left: auto; width: 100%; height: auto; display: flex; flex-direction: column; align-items: center; }
            .info-bubbles { position: relative; transform: none; top: auto; left: auto; width: 90vw; height: auto; margin-top: -20px; padding-bottom: 40px; display: flex; flex-direction: column; gap: 8px; align-items: center; flex-shrink: 0; }
            .bubble { position: relative; top: auto !important; left: auto !important; right: auto !important; bottom: auto !important; width: 100%; max-width: 100%; text-align: center; padding: 12px 15px; }
            .b-top-right { text-align: center; }
            .info-bubbles .bubble:nth-child(n+2) { display: flex; align-items: center; justify-content: center; min-height: 52px; padding: 0 15px; }

            .mockup-wrapper { flex: 0 1 auto; display: flex; align-items: flex-start; justify-content: center; width: 100%; margin-top: 15vh; }
            .p1 .mockup-img, .p2 .mockup-img, .p3 .mockup-img { width: auto; max-width: 85vw; max-height: 55vh; object-fit: contain; }
            
            .string-rack { position: absolute; top: 0; z-index: 0; opacity: 0.5; height: 40vh !important; }
        }
 
    </style>
</head>
<body>

    <section id="hero"><h1>Final Build</h1><p>ë§ˆë¦¬ì˜¤ë„¤íŠ¸ & ì¸í„°ë™í‹°ë¸Œ ê°¤ëŸ¬ë¦¬</p></section>
    <section id="about"><h2>About Me</h2><p>ë§ˆë¦¬ì˜¤ë„¤íŠ¸ ì»¨ì…‰ ì†Œê°œ ë° ìê¸°ì†Œê°œ</p></section>
    
    <section id="stage">
        
        <div class="marionette-group p1">
            <div class="pendulum">
                <div class="string-rack" data-height="30vh" data-width="500px"></div>
                <div class="mockup-wrapper">
                    <img src="/img/mockup1.png" onerror="this.src='https://placehold.co/600x400/1a1a1a/FFF?text=Web+Project'" alt="Web Project" class="mockup-img">
                </div>
                <div class="info-bubbles">
                    <div class="bubble b-top-left"><h3>E-Commerce Platform</h3><p>ì‡¼í•‘ëª° ë¦¬ë‰´ì–¼ í”„ë¡œì íŠ¸</p></div>
                    <div class="bubble b-top-right"><p><strong>Front-end Lead</strong> / React</p></div>
                    <a href="#" class="bubble b-bottom-left" style="background: rgba(255,255,255,0.15);">ê¸°íšì„œ ë°”ë¡œê°€ê¸°</a>
                    <a href="#" class="bubble b-bottom-right" style="background: rgba(255,255,255,0.15);">í”„ë¡œí† íƒ€ì… ë³´ê¸°</a>
                </div>
            </div>
        </div>

        <div class="marionette-group p2">
            <div class="pendulum">
                <div class="string-rack" data-height="15vh" data-width="300px"></div>
                <div class="mockup-wrapper">
                    <img src="/img/mockup2.png" onerror="this.src='https://placehold.co/300x600/222/FFF?text=Mobile+App'" alt="Mobile App" class="mockup-img">
                </div>
                <div class="info-bubbles">
                    <div class="bubble b-top-left"><h3>Fitness Tracker</h3><p>ìš´ë™ ì½”ì¹­ ì•±</p></div>
                    <div class="bubble b-top-right"><p><strong>UI/UX Designer</strong> / Figma</p></div>
                    <a href="#" class="bubble b-bottom-left">ê¸°íšì„œ ë°”ë¡œê°€ê¸°</a>
                    <a href="#" class="bubble b-bottom-right">ì•± ì‹¤í–‰í•´ë³´ê¸°</a>
                </div>
            </div>
        </div>

        <div class="marionette-group p3">
            <div class="pendulum">
                <div class="string-rack" data-height="25vh" data-width="400px"></div>
                <div class="mockup-wrapper">
                    <img src="https://placehold.co/500x500/333/FFF?text=Design" alt="Design Project" class="mockup-img">
                </div>
                <div class="info-bubbles">
                    <div class="bubble b-top-left"><h3>Interactive Art</h3><p>ë¯¸ë””ì–´ ì•„íŠ¸ ì „ì‹œ</p></div>
                    <div class="bubble b-top-right"><p><strong>Creative Director</strong></p></div>
                    <a href="#" class="bubble b-bottom-left">ì „ì‹œ ê¸°íšì•ˆ</a>
                    <a href="#" class="bubble b-bottom-right">ì¸í„°ë™ì…˜ ì˜ìƒ</a>
                </div>
            </div>
        </div>

    </section>

    <section id="gallery-stage">
        <div class="gallery-bg">
            <!-- ë°°ê²½ ë¹„ë””ì˜¤ íƒœê·¸ ì œê±° -->
            <img id="bg-img" src="https://placehold.co/1920x1080/111/FFF?text=Select+Menu" alt="Background" style="opacity: 1;">
            <div class="overlay"></div>
        </div>

        <div class="gallery-content">
            <!-- ê°¤ëŸ¬ë¦¬ ì•„ì´í…œ 10ê°œë¡œ ì¤„ì„ -->
            <!-- ì¸ë„¤ì¼ ì´ë¯¸ì§€ í¬ê¸°ëŠ” 600x375 (16:10), í’€ ìŠ¤í¬ë¦°ì€ 1200x800 -->
            
            <div class="word-item" data-type="image" data-src="/img/p1.jpg">
                <img src="/img/p1.jpg" alt="Design System Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">ì‹ ë¬¸ í‘ë°± ì‚½í™”</div>
            </div>
            
            <div class="word-item" data-type="image" data-src="/img/p2.jpg">
                <img src="/img/p2.jpg" alt="Branding Guide Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">ì‹ ë¬¸ í‘ë°± ì‚½í™”</div>
            </div>
            
            <div class="word-item" data-type="image" data-src="/img/p4.png">
                <img src="/img/p4.png" alt="Photography Series Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">ê²Œì„ ìºë¦­í„° ë””ìì¸</div>
            </div>
            <div class="word-item" data-type="image" data-src="/img/p3.jpg">
                <img src="/img/p3.jpg" alt="Infographic Design Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">ì‹ ë¬¸ í‘ë°± ì‚½í™”</div>
            </div>


            <div class="word-item" data-type="image" data-src="/img/p5.jpg">
                <img src="/img/p5.jpg" alt="Mobile UX Case Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">ì‹ ë¬¸ í‘ë°± ì‚½í™”</div>
            </div>

            <div class="word-item" data-type="image" data-src="/img/p6.jpg">
                <img src="/img/p6.jpg" alt="Data Visualization Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">ì‹ ë¬¸ í‘ë°± ì‚½í™”</div>
            </div>

            <div class="word-item" data-type="image" data-src="/img/p8.png">
                <img src="/img/p8.png" alt="Landing Page A/B Test Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">ê°œì¸ ìºë¦­í„° ë””ìì¸</div>
            </div>
            <div class="word-item" data-type="image" data-src="/img/p7.jpg">
                <img src="/img/p7.jpg" alt="E-Commerce Wireframe Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">ì‹ ë¬¸ í‘ë°± ì‚½í™”</div>
            </div>


            <div class="word-item" data-type="image" data-src="https://contents.kyobobook.co.kr/sih/fit-in/458x0/pdt/9788969021915.jpg">
                <img src="https://contents.kyobobook.co.kr/sih/fit-in/458x0/pdt/9788969021915.jpg" alt="Showreel Image Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">ë„ì„œ ì»¬ëŸ¬ ì‚½í™”</div>
            </div> 

            <div class="word-item" data-type="image" data-src="/img/p10.jpg">
                <img src="/img/p10.jpg" alt="Interactive Prototype Thumbnail" class="thumbnail-img">
                <div class="thumbnail-caption">ì‹ ë¬¸ í‘ë°± ì‚½í™”</div>
            </div>
            
            <!-- í•­ëª© 11-15 ì œê±°ë¨ -->

        </div>
    </section>

    <footer><p>End</p></footer>

    <!-- ===== ëª¨ë‹¬ HTML êµ¬ì¡° ìœ ì§€ (ë¹„ë””ì˜¤ ì œê±°ë¨) ===== -->
    <div id="image-modal" class="fixed inset-0 z-50 hidden bg-black bg-opacity-90 flex items-center justify-center p-4" aria-modal="true" role="dialog">
        
        <!-- ë¡œë”© ìŠ¤í”¼ë„ˆ (ì´ë¯¸ì§€ ë¡œë“œ ì „ í‘œì‹œ) -->
        <div id="loading-spinner" class="text-white flex flex-col items-center">
            <!-- SVG ìŠ¤í”¼ë„ˆ -->
            <svg class="animate-spin -ml-1 mr-3 h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <p class="mt-2 text-sm">ì½˜í…ì¸  ë¡œë”© ì¤‘...</p>
        </div>

        <!-- ëª¨ë‹¬ ì»¨í…ì¸  ì»¨í…Œì´ë„ˆ (ë¡œë”© í›„ í‘œì‹œ) -->
        <div id="modal-content-wrapper" class="max-w-full max-h-full overflow-hidden flex justify-center items-center hidden">
            <!-- ì´ë¯¸ì§€ ëª¨ë‹¬ (cursor-pointerëŠ” í´ë¦­ ì‹œ ë‹«ê¸° ìœ„í•¨) -->
            <img id="modal-image" src="" alt="ì „ì²´ í™”ë©´ ì´ë¯¸ì§€" class="max-w-full max-h-screen object-contain rounded-lg shadow-2xl transition-all duration-300 cursor-pointer">
        </div>
        
    </div>
    <!-- ===== ëª¨ë‹¬ HTML êµ¬ì¡° ë ===== -->

    <script>
        gsap.registerPlugin(ScrollTrigger);

        // --- 1. ë§ˆë¦¬ì˜¤ë„¤íŠ¸ ë¡œì§ (ê¸°ì¡´) ---
        function createBalancedStrings() {
            const racks = document.querySelectorAll('.string-rack');
            const zones = [{ min: 5, max: 20 }, { min: 30, max: 45 }, { min: 55, max: 70 }, { min: 80, max: 95 }];

            racks.forEach(rack => {
                rack.innerHTML = ''; 
                const isMobile = window.innerWidth <= 768;
                let w = rack.dataset.width; 
                if (isMobile) { rack.style.maxWidth = '90vw'; } 
                else { rack.style.maxWidth = 'none'; rack.style.height = rack.dataset.height; }
                rack.style.width = w;

                zones.forEach(zone => {
                    const string = document.createElement('div');
                    string.classList.add('string');
                    const randomLeft = Math.floor(Math.random() * (zone.max - zone.min + 1)) + zone.min;
                    string.style.left = `${randomLeft}%`;
                    const minOp = 0.10; const maxOp = 0.40;
                    const op = (Math.random() * (maxOp - minOp) + minOp).toFixed(2);
                    string.style.background = `rgba(255, 255, 255, ${op})`;
                    string.style.boxShadow = `0 0 ${op * 2}px rgba(255, 255, 255, ${op * 0.3})`;
                    rack.appendChild(string);
                });
            });
        }
        
        createBalancedStrings();
        window.addEventListener('resize', () => { createBalancedStrings(); });


        // --- 2. ë§ˆë¦¬ì˜¤ë„¤íŠ¸ íƒ€ì„ë¼ì¸ ---
        const tl = gsap.timeline({
            scrollTrigger: { trigger: "#stage", start: "top top", end: "+=8000", pin: true, scrub: 1 }
        });

        gsap.set(".marionette-group", { autoAlpha: 0 }); 
        gsap.set(".bubble", { y: 30, autoAlpha: 0 }); 

        const isMobile = window.innerWidth <= 768;
        const startX_Right = isMobile ? 0 : "35vw";
        const startX_Left = isMobile ? 0 : "-35vw";
        
        // P1 -> P2 -> P3 Sequence
        tl.fromTo(".p1", { x: startX_Right, scale: 0.5, filter: "blur(10px)", autoAlpha: 0 }, { x: "0%", scale: 1, filter: "blur(0px)", autoAlpha: 1, duration: 5, ease: "power1.out" })
          .to(".p1 .bubble", { autoAlpha: 1, y: 0, duration: 1, stagger: 0.15, ease: "back.out(1.7)" })
          .to({}, { duration: 3 }) 
          .to(".p1 .bubble", { autoAlpha: 0, y: -30, duration: 0.5, stagger: 0.05 })
          .to(".p1", { scale: 5, autoAlpha: 0, filter: "blur(20px)", duration: 3 })
          
          .fromTo(".p2", { x: startX_Left, scale: 0.5, filter: "blur(10px)", autoAlpha: 0 }, { x: "0%", scale: 1, filter: "blur(0px)", autoAlpha: 1, duration: 5, ease: "power1.out" })
          .to(".p2 .bubble", { autoAlpha: 1, y: 0, duration: 1, stagger: 0.15, ease: "back.out(1.7)" })
          .to({}, { duration: 3 })
          .to(".p2 .bubble", { autoAlpha: 0, y: -30, duration: 0.5, stagger: 0.05 })
          .to(".p2", { scale: 5, autoAlpha: 0, filter: "blur(20px)", duration: 3 })
          
          .fromTo(".p3", { x: startX_Right, scale: 0.5, filter: "blur(10px)", autoAlpha: 0 }, { x: "0%", scale: 1, filter: "blur(0px)", autoAlpha: 1, duration: 5, ease: "power1.out" })
          .to(".p3 .bubble", { autoAlpha: 1, y: 0, duration: 1, stagger: 0.15, ease: "back.out(1.7)" })
          .to({}, { duration: 3 })
          .to(".p3 .bubble", { autoAlpha: 0, y: -30, duration: 0.5, stagger: 0.05 })
          .to(".p3", { scale: 5, autoAlpha: 0, filter: "blur(20px)", duration: 3 });


        // --- 3. ë¬¼ë¦¬ ì—”ì§„ (Ticker) ---
        const groups = document.querySelectorAll(".marionette-group");
        const CONFIG = { TENSION: 0.04, FRICTION: 0.85, FORCE: 0.015, MAX_ANGLE: 3 }; 

        groups.forEach(group => {
            const pendulum = group.querySelector(".pendulum");
            let rotation = 0; let velocity = 0; let prevX = null;
            
            gsap.ticker.add(() => {
                const currentX = group.getBoundingClientRect().left;
                if (prevX === null || Math.abs(currentX) > 10000) { prevX = currentX; return; }
                const dx = currentX - prevX;
                const opacity = window.getComputedStyle(group).opacity;
                
                if (Math.abs(dx) < 50 && opacity > 0.1) { 
                    velocity += dx * CONFIG.FORCE; velocity += -rotation * CONFIG.TENSION; velocity *= CONFIG.FRICTION; rotation += velocity;
                    if (rotation > CONFIG.MAX_ANGLE) rotation = CONFIG.MAX_ANGLE;
                    if (rotation < -CONFIG.MAX_ANGLE) rotation = -CONFIG.MAX_ANGLE;
                    if (Math.abs(rotation) < 0.01 && Math.abs(velocity) < 0.01) { rotation = 0; velocity = 0; }
                } else { velocity = 0; }
                
                const xPercent = window.innerWidth <= 768 ? 0 : -50;
                gsap.set(pendulum, { xPercent: xPercent, rotation: rotation });
                prevX = currentX;
            });
        });


        // --- 4. ê°¤ëŸ¬ë¦¬ ì„¹ì…˜ ë¡œì§ (ì´ë¯¸ì§€ ì „ìš© ëª¨ë‹¬ ë° ìŠ¤í¬ë¡¤ ê³ ì •) ---
        
        // (1) ê°¤ëŸ¬ë¦¬ ìŠ¤í¬ë¡¤ ê³ ì • ë° íƒ€ì„ë¼ì¸ ì •ì˜
        const galleryTl = gsap.timeline({
            scrollTrigger: { 
                trigger: "#gallery-stage", 
                start: "top top", 
                end: "+=3000", // ìŠ¤í¬ë¡¤ ì†ë„ë¥¼ ë†’ì´ê¸° ìœ„í•´ 3000pxë¡œ ì¡°ì •
                pin: true, 
                scrub: 1 
            }
        });

        const items = document.querySelectorAll(".word-item");
        
        // (2) ê°¤ëŸ¬ë¦¬ ì•„ì´í…œ ìˆœì°¨ì  ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ (ìŠ¤í¬ë¡¤ì— ë°˜ì‘)
        items.forEach((item, index) => {
            galleryTl.fromTo(item, 
                { 
                    y: -100, // ìœ„ì—ì„œ ì‹œì‘
                    opacity: 0, 
                    rotation: "random(-10, 10)",
                    scale: 0.8
                },
                {
                    y: 0,
                    opacity: 1,
                    rotation: 0,
                    scale: 1,
                    duration: 1.5, // ë“±ì¥ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„
                    ease: "power3.out"
                },
                index * 0.25 // ì•„ì´í…œë³„ ê°„ê²©
            );
        });

        // (3) ëª¨ë‹¬ ìš”ì†Œ ì •ì˜ ë° ë¡œì§ (ê¸°ì¡´ ìœ ì§€)
        const galleryBgImg = document.getElementById("bg-img");
        
        const modal = document.getElementById('image-modal');
        const modalContentWrapper = document.getElementById('modal-content-wrapper');
        const loadingSpinner = document.getElementById('loading-spinner');
        const modalImage = document.getElementById('modal-image');

        // [MODIFIED] ë°°ê²½ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (í˜¸ë²„ ë° í´ë¦­ ì‹œ ì‚¬ìš©) - íŠ¸ëœì§€ì…˜ ë° ì¸í„°ëŸ½íŠ¸ ì²˜ë¦¬ ì¶”ê°€
        const updateGalleryBackground = (src) => {
             // 1. ì´ë¯¸ ê°™ì€ ì†ŒìŠ¤ì¸ì§€ í™•ì¸
             if (galleryBgImg.src.includes(src)) {
                 return; 
            }
            
            // 2. í˜„ì¬ galleryBgImgì— ëŒ€í•œ ëª¨ë“  GSAP ì• ë‹ˆë©”ì´ì…˜ì„ ë©ˆì¶¥ë‹ˆë‹¤.
            // ì´ë¡œì¨ ì´ì „ ì• ë‹ˆë©”ì´ì…˜ì˜ onComplete ì½œë°±ì´ ì˜ëª» ì‹¤í–‰ë˜ì–´ ì´ë¯¸ì§€ê°€ ê¹œë¹¡ì´ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.
            gsap.killTweensOf(galleryBgImg);

            // 3. ê°¤ëŸ¬ë¦¬ ë°°ê²½ ë³€ê²½ (ì´ë¯¸ì§€ë¡œë§Œ ì²˜ë¦¬) - í˜ì´ë“œ ì•„ì›ƒ/ì¸ ì²´ì¸
            gsap.to(galleryBgImg, { 
                opacity: 0, 
                duration: 0.3, // í˜ì´ë“œ ì•„ì›ƒ ì‹œê°„ ë‹¨ì¶• (0.5 -> 0.3)
                filter: 'blur(5px)', // ë¸”ëŸ¬ íš¨ê³¼ ìœ ì§€
                onComplete: () => {
                    // 4. í˜ì´ë“œ ì•„ì›ƒ ì™„ë£Œ í›„ ì´ë¯¸ì§€ ì†ŒìŠ¤ ë³€ê²½
                    galleryBgImg.src = src;
                    
                    // 5. ìƒˆ ì´ë¯¸ì§€ë¡œ í˜ì´ë“œ ì¸ ë° ë¸”ëŸ¬ í•´ì œ
                    gsap.to(galleryBgImg, { 
                        opacity: 1, 
                        duration: 0.7, // í˜ì´ë“œ ì¸ ì‹œê°„ ë‹¨ì¶• (1.0 -> 0.7)
                        filter: 'blur(0px)' 
                    });
            }});
        };

        // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        const closeModal = () => {
            modalContentWrapper.classList.remove('modal-enter-active');
            modal.classList.add('hidden');
            modalImage.src = ''; 
        };
        
        // ì´ë¯¸ì§€ ë¡œë”© í•¨ìˆ˜ (ì´ë¯¸ì§€ ì „ìš©)
        const openModal = (src) => {
            modal.classList.remove('hidden');
            loadingSpinner.classList.remove('hidden');
            modalContentWrapper.classList.add('hidden');
            modalImage.style.display = 'none';

            const tempImg = new Image();
            tempImg.onload = () => {
                modalImage.src = src;
                modalImage.style.display = 'block';
                loadingSpinner.classList.add('hidden');
                modalContentWrapper.classList.remove('hidden');
                modalContentWrapper.classList.add('modal-enter-active');
            };
            tempImg.onerror = () => {
                loadingSpinner.classList.add('hidden');
                console.error("Failed to load image:", src);
                closeModal();
            };
            tempImg.src = src;
        };


        // 5. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°: HOVER (mouseover/mouseout) ë° CLICK
        items.forEach(item => {
            const src = item.dataset.src;
            
            // [MODIFIED] 5a. HOVER (mouseover) ì´ë²¤íŠ¸: ë°°ê²½ ì´ë¯¸ì§€ ë³€ê²½
            item.addEventListener("mouseover", () => {
                updateGalleryBackground(src);
            });

            // [REMOVED] 5b. HOVER OUT (mouseout) ì´ë²¤íŠ¸: ë°°ê²½ ì´ë¯¸ì§€ë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ë¡œì§ ì œê±°
            // ë§ˆìš°ìŠ¤ê°€ ë‚˜ê°€ë„ ë°°ê²½ì´ ë§ˆì§€ë§‰ í˜¸ë²„ ì´ë¯¸ì§€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.

            // [MODIFIED] 5c. CLICK ì´ë²¤íŠ¸: ëª¨ë‹¬ íŒì—…ë§Œ ì‹¤í–‰
            item.addEventListener("click", () => {
                openModal(src);
            });
        });

        // 6. ëª¨ë‹¬ ë‹«ê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        modalImage.addEventListener('click', closeModal); // ì´ë¯¸ì§€ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
        
        modal.addEventListener('click', (e) => { // ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
            if (e.target === modal) {
                closeModal();
            }
        });

        // ESC í‚¤ ì…ë ¥ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                closeModal();
            }
        });

    </script>
</body>
</html>